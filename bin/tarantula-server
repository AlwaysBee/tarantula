#!/usr/bin/env node

'use strict'

const program = require("commander"),
          pm2 = require('pm2')

const version = (() => {
  try{
   return require("tarantula/package.json").version
  }catch(e){
   return 'dev'
  }
})()

program
  .version(version)
  .option('-p --port <port>', "listen port")
  .parse(process.argv)


;(async () => {
  const pm2Config = require.resolve("tarantulajs/pm2.json")

  pm2.connect(function(err) {
    if (err) {
      console.error(err);
      process.exit(2);
    }

    pm2.start(pm2Config, function(err, apps) {
      pm2.disconnect();   // Disconnects from PM2
      if (err) throw err
    })
  })
})()
